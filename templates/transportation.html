<!DOCTYPE html>
<html>
<head>
    <title>Transportation Information</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
    <script>
        function updateTransportForm() {
            let working = document.getElementById("working").value;
            let transportMode = document.getElementById("mode_of_transport").value;
            let leisureDays = document.getElementById("leisure_days").value;
            let leisureMode = document.getElementById("leisure_mode").value;

            // Work Travel - Hide/Show based on "Are you working?"
            document.getElementById("work_travel_section").style.display = working === "yes" ? "block" : "none";

            // Transport Mode - Hide/Show based on selection
            document.getElementById("car_options").style.display = "none";
            document.getElementById("public_transport_options").style.display = "none";
            if (transportMode === "car") {
                document.getElementById("car_options").style.display = "block";
            } else if (transportMode === "public transport") {
                document.getElementById("public_transport_options").style.display = "block";
            }

            // Leisure Travel - Hide/Show based on leisure days
            document.getElementById("leisure_travel_section").style.display = leisureDays > 0 ? "block" : "none";

            // Leisure Mode - Hide/Show transport type based on selection
            let leisureTypeSection = document.getElementById("leisure_type_section");
            let leisureTypeSelect = document.getElementById("leisure_type");

            leisureTypeSelect.innerHTML = ""; // Clear previous options
            if (leisureMode === "car") {
                leisureTypeSection.style.display = "block";
                leisureTypeSelect.innerHTML = `
                    <option value="petrol">Petrol</option>
                    <option value="diesel">Diesel</option>
                    <option value="electric">Electric</option>
                `;
            } else if (leisureMode === "public transport") {
                leisureTypeSection.style.display = "block";
                leisureTypeSelect.innerHTML = `
                    <option value="bus">Bus</option>
                    <option value="tube">Tube</option>
                    <option value="both">Both</option>
                `;
            } else {
                leisureTypeSection.style.display = "none";
            }
        }

        function validateForm(event) {
            let valid = true;
            let errors = [];

            // Get values
            let working = document.getElementById("working").value;
            let leisureDays = document.getElementById("leisure_days").value;
            let distanceToWork = document.getElementById("distance_to_work")?.value;
            let workDays = document.getElementById("work_days")?.value;
            let leisureDistance = document.getElementById("leisure_distance")?.value;

            // Validation checks
            if (working === "yes") {
                if (distanceToWork && distanceToWork < 0) {
                    errors.push("Distance to work cannot be negative.");
                }
                if (workDays && (workDays < 1 || workDays > 7)) {
                    errors.push("Work days must be between 1 and 7.");
                }
            }
            if (leisureDays > 0) {
                if (leisureDistance && leisureDistance < 0) {
                    errors.push("Leisure travel distance cannot be negative.");
                }
            }

            // Display errors if any
            let errorBox = document.getElementById("error_messages");
            errorBox.innerHTML = "";
            if (errors.length > 0) {
                event.preventDefault();  // Prevent form submission
                errorBox.innerHTML = "<ul><li>" + errors.join("</li><li>") + "</li></ul>";
            }
        }
    </script>
</head>
<body onload="updateTransportForm()">
    <h1>Enter Your Transportation Details</h1>

    <div id="error_messages" style="color: red;"></div> <!-- Error messages appear here -->

    <form method="POST" onsubmit="validateForm(event)">
        <h2>Work Travel</h2>
        
        <label title="Do you currently have a job that requires commuting?">Are you working?</label>
        <select name="working" id="working" onchange="updateTransportForm()">
            <option value="yes">Yes</option>
            <option value="no">No</option>
        </select><br>

        <div id="work_travel_section" style="display: none;">
            <label title="Enter the one-way distance from home to work in km.">Distance to Work (km):</label>
            <input type="number" id="distance_to_work" name="distance_to_work" step="0.1" placeholder="e.g., 5"><br>

            <label title="How many days per week do you commute to work? (1-7)">Work Days per Week:</label>
            <input type="number" id="work_days" name="work_days" min="1" max="7" placeholder="e.g., 5"><br>

            <label title="Select how you commute to work most often.">Mode of Transport:</label>
            <select name="mode_of_transport" id="mode_of_transport" onchange="updateTransportForm()">
                <option value="walk">Walk</option>
                <option value="cycle">Cycle</option>
                <option value="public transport">Public Transport</option>
                <option value="car">Car</option>
            </select><br>

            <!-- Car Options -->
            <div id="car_options" style="display:none;">
                <label title="What type of car do you drive?">Car Type:</label>
                <select name="work_car_type">
                    <option value="petrol">Petrol</option>
                    <option value="diesel">Diesel</option>
                    <option value="electric">Electric</option>
                </select><br>
            </div>

            <!-- Public Transport Options -->
            <div id="public_transport_options" style="display:none;">
                <label title="What type of public transport do you use?">Public Transport Type:</label>
                <select name="work_type">
                    <option value="bus">Bus</option>
                    <option value="tube">Tube</option>
                    <option value="both">Both</option>
                </select><br>
            </div>
        </div>

        <h2>Leisure Travel</h2>
        <label title="How many days per week do you travel for errands, shopping, or social activities? (0-7)">Leisure Travel Days per Week:</label>
        <input type="number" id="leisure_days" name="leisure_days" min="0" max="7" placeholder="e.g., 3" onchange="updateTransportForm()"><br>

        <div id="leisure_travel_section" style="display: none;">
            <label title="On average, how far do you travel per leisure trip in km?">Leisure Travel Distance per Trip (km):</label>
            <input type="number" id="leisure_distance" name="leisure_distance" step="0.1" placeholder="e.g., 10"><br>

            <label title="Select how you usually travel for leisure activities.">Leisure Mode of Transport:</label>
            <select name="leisure_mode" id="leisure_mode" onchange="updateTransportForm()">
                <option value="">None</option>
                <option value="car">Car</option>
                <option value="public transport">Public Transport</option>
                <option value="cycle">Cycle</option>
                <option value="walk">Walk</option>
            </select><br>

            <div id="leisure_type_section" style="display: none;">
                <label title="Specify your leisure transport type (e.g., bus, tube, petrol car, etc.).">Leisure Transport Type:</label>
                <select name="leisure_type" id="leisure_type">
                    <!-- Options will be inserted dynamically -->
                </select><br>
            </div>
        </div>

        <button type="submit">Next</button>
    </form>
</body>
</html>
